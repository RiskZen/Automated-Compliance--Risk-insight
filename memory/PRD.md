# GRC Platform - Product Requirements Document

## Original Problem Statement
Build a GRC (Governance, Risk, and Compliance) application for an interview case study. The scope evolved into a full-featured, sellable, dynamic GRC platform using the pure Python Reflex framework.

## Core Requirements

### 1. Framework Management
- Ingest standard frameworks (PCI DSS, ISO 27001, SOC2, NIST, GDPR)
- Allow users to select and enable/disable frameworks
- **Status**: COMPLETED

### 2. Unified Controls (CCF)
- Map selected frameworks to a unified set of internal policies
- Interactive and expandable mapping visualization
- **Status**: COMPLETED

### 3. Control Testing
- Page to manage control testing activities
- Record test results with evidence
- **Status**: COMPLETED (Feb 16, 2026)

### 4. Issue Management
- Track issues found during control testing
- Issue lifecycle management (Open → In Progress → Resolved)
- **Status**: COMPLETED (Feb 16, 2026)

### 5. Risk Management
- Define top risks with AI recommendations
- Dynamic mapping: Risks → KRIs → KCIs
- **Status**: COMPLETED

### 6. KRI Management (Key Risk Indicators)
- Monitor metrics indicating risk level changes
- Threshold-based alerting (Green/Yellow/Red)
- **Status**: COMPLETED (Feb 16, 2026)

### 7. KCI Management (Key Control Indicators)
- Monitor control effectiveness metrics
- Threshold-based alerting
- **Status**: COMPLETED (Feb 16, 2026)

### 8. Visual Risk Heatmaps
- Risk Matrix (Impact vs Likelihood grid)
- Risk Relationship Network (Risks → KRIs → KCIs flow)
- **Status**: COMPLETED (Feb 16, 2026)

### 9. Dynamic Dashboard
- Real-time compliance and risk management overview
- Metrics: Enabled Frameworks, Control Effectiveness, Open Issues, Avg Risk Score
- **Status**: COMPLETED

### 10. AI Integration
- Google Gemini for risk recommendations (MOCKED currently)
- **Status**: Integration ready, needs API key

## Technology Stack
- **Framework**: Reflex (Pure Python)
- **Database**: MongoDB (via pymongo - synchronous)
- **Frontend**: Auto-generated by Reflex
- **AI**: Google Gemini API (mocked)

## Current Application Status
- **Working Application**: YES
- **All Pages Implemented**: YES
- **Testing Status**: 100% PASSED (10/10 pages)
- **Data**: MOCK data via seed script

## Pages Implemented
1. `/` - Dashboard
2. `/frameworks` - Framework Management
3. `/controls` - Control Mapping
4. `/policies` - Policy Management
5. `/testing` - Control Testing (NEW)
6. `/issues` - Issue Management (NEW)
7. `/risks` - Risk Management
8. `/kris` - KRI Management (NEW)
9. `/kcis` - KCI Management (NEW)
10. `/heatmap` - Risk Heatmap Visualization (NEW)

## Database Schema
- **frameworks**: {id, name, description, version, enabled, total_controls, controls[]}
- **unified_controls**: {id, ccf_id, name, description, control_type, frequency, owner, mapped_framework_controls[], mapped_policies[]}
- **policies**: {id, policy_id, name, description, category, owner, status}
- **control_tests**: {id, control_id, control_ccf_id, test_date, tester, result, evidence, notes}
- **issues**: {id, title, description, severity, status, control_id, assigned_to, due_date}
- **risks**: {id, name, description, category, inherent_risk_score, residual_risk_score, status, owner, kri_ids[], linked_control_ids[]}
- **kris**: {id, name, description, risk_id, threshold_green/yellow/red, current_value, unit, frequency, owner}
- **kcis**: {id, name, description, kri_id, control_id, threshold_green/yellow/red, current_value, unit, frequency, owner}

## Key Files
- `/app/reflex-grc/grc_platform/grc_platform.py` - Main app with all pages
- `/app/reflex-grc/grc_platform/state.py` - State classes
- `/app/reflex-grc/grc_platform/database.py` - MongoDB service
- `/app/reflex-grc/seed_data.py` - Database seeding script
- `/app/reflex-grc/rxconfig.py` - Reflex configuration

## Running the Application
```bash
cd /app/reflex-grc
reflex run --env prod --single-port --frontend-port 3000
```

## Future/Backlog Tasks
1. **P1**: Connect to real MongoDB Atlas database
2. **P1**: Configure Google Gemini API key for AI suggestions
3. **P2**: Add user authentication and roles
4. **P2**: Export reports (PDF/Excel)
5. **P2**: Email notifications for issues
6. **P3**: API endpoints for external integrations

## What's Been Implemented (Feb 16, 2026)
- Control Testing page with test recording functionality
- Issues page with issue lifecycle management
- KRI Management page with threshold indicators
- KCI Management page with control effectiveness metrics
- Risk Heatmap page with:
  - 5x5 Risk Matrix (Impact vs Likelihood)
  - Risk Relationship Network (3-column layout showing Risks → KRIs → KCIs)
  - Summary statistics

## Known Limitations
- Uses MOCK data (local MongoDB)
- AI features return placeholder suggestions
- No user authentication
- No file upload for evidence (text references only)
